<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Giriş / Kayıt</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
  <style>
    @keyframes waveAnim {
      0% { transform: translateX(0) translateY(50%); }
      100% { transform: translateX(-50%) translateY(50%); }
    }
    @keyframes backgroundShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    body {
      margin: 0;
      background: linear-gradient(45deg, #001f3f, #000814, #003366);
      background-size: 600% 600%;
      animation: backgroundShift 20s ease infinite;
      overflow: hidden;
    }
    #wave {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 200%;
      height: 200px;
      opacity: 0.25;
      animation: waveAnim 8s linear infinite;
      transform: translateY(50%);
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen text-white transition-colors duration-300 dark:bg-black">
  <svg id="wave" viewBox="0 0 1200 200">
    <path fill="#001f3f" d="M0,100 C300,200 900,0 1200,100 L1200,200 L0,200 Z"/>
  </svg>

  <div class="w-full max-w-md p-6 mx-4 rounded-2xl bg-white/10 backdrop-blur-lg shadow-xl">
    <div class="flex justify-between mb-6">
      <h2 class="text-2xl font-semibold" id="formTitle">🔐 Giriş Yap</h2>
      <button id="toggleMode" class="text-sm text-blue-300 hover:underline">🌙</button>
    </div>
    <div id="usernameGroup" class="hidden">
      <input id="username" type="text" placeholder="Kullanıcı Adı"
        class="w-full mb-4 px-4 py-2 rounded-md bg-gray-100 bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
    </div>
    <input id="email" type="email" placeholder="E-posta"
      class="w-full mb-4 px-4 py-2 rounded-md bg-gray-100 bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
    <input id="password" type="password" placeholder="Şifre"
      class="w-full mb-4 px-4 py-2 rounded-md bg-gray-100 bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
    <div class="flex items-center mb-4">
      <input id="rememberMe" type="checkbox" class="mr-2">
      <label for="rememberMe" class="text-sm">Beni hatırla</label>
    </div>
    <button id="authButton" onclick="login()" class="w-full py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white font-medium transition">
      Giriş Yap
    </button>
    <p class="mt-4 text-sm text-center">
      <span id="toggleText">Hesabınız yok mu?</span>
      <button onclick="switchMode()" class="text-blue-300 hover:underline" id="switchBtn">Kayıt Ol</button>
    </p>
    <div id="message" class="mt-4 text-sm text-center font-medium"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCEnHNZh6MZ1bZWDsBYA3nEm1ZvhDxI38s",
      authDomain: "yankistudioweb.firebaseapp.com",
      projectId: "yankistudioweb",
      storageBucket: "yankistudioweb.appspot.com",
      messagingSenderId: "1036422092091",
      appId: "1:1036422092091:web:1651d21b5d91643499131e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script>
    let isLogin = true;

    function switchMode() {
      isLogin = !isLogin;
      document.getElementById('formTitle').textContent = isLogin ? '🔐 Giriş Yap' : '🆕 Kayıt Ol';
      document.getElementById('authButton').textContent = isLogin ? 'Giriş Yap' : 'Kayıt Ol';
      document.getElementById('toggleText').textContent = isLogin ? 'Hesabınız yok mu?' : 'Zaten hesabınız var mı?';
      document.getElementById('switchBtn').textContent = isLogin ? 'Kayıt Ol' : 'Giriş Yap';
      document.getElementById('message').textContent = '';
      document.getElementById('usernameGroup').classList.toggle('hidden', isLogin);
    }

    function login() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      const username = document.getElementById('username').value.trim();
      const message = document.getElementById('message');
      const remember = document.getElementById('rememberMe').checked;

      if (!email || !password || (!isLogin && !username)) {
        message.textContent = '⚠️ Lütfen tüm alanları doldurunuz.';
        message.className = 'text-yellow-400';
        return;
      }

      const persistence = remember ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION;
      firebase.auth().setPersistence(persistence).then(() => {
        if (isLogin) {
          return firebase.auth().signInWithEmailAndPassword(email, password);
        } else {
          return firebase.auth().createUserWithEmailAndPassword(email, password)
            .then(async ({ user }) => {
              await db.collection("users").doc(user.uid).set({ username, email });
              await user.sendEmailVerification();
              throw new Error('📧 Kayıt başarılı. Lütfen e‑posta adresinizi doğrulayın.');
            });
        }
      }).then(({ user }) => {
        if (!user.emailVerified) {
          message.textContent = '📧 Lütfen e‑posta adresinizi doğrulayın.';
          message.className = 'text-red-400';
          return;
        }
        message.textContent = '✅ Başarıyla giriş yapıldı!';
        message.className = 'text-green-400';
        setTimeout(() => window.location.href = 'dashboard.html', 1500);
      }).catch(err => {
        let msg = err.message || '❌ Hata oluştu.';
        if (err.code === 'auth/user-not-found') msg = '🚫 Kullanıcı bulunamadı.';
        else if (err.code === 'auth/wrong-password') msg = '🔑 Hatalı şifre.';
        else if (err.code === 'auth/email-already-in-use') msg = '📧 Bu e-posta zaten kayıtlı.';
        else if (err.code === 'auth/invalid-email') msg = '📧 Geçersiz e-posta.';
        else if (msg.includes('doğrulayın')) {
          message.textContent = msg;
          message.className = 'text-blue-400';
          return;
        }
        message.textContent = msg;
        message.className = 'text-red-400';
      });
    }

    document.getElementById('toggleMode').onclick = () => {
      document.documentElement.classList.toggle('dark');
    };
  </script>
</body>
</html>
